<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            border: 0;
        }
        .canvas-wrap {

        }
        .canvas {

        }
    </style>
</head>
<body>

    <div id="canvasWrap" class="canvas-wrap" data-img="./images/bg.jpg">
        <canvas class="canvas" id="canvas" width="300" height="300">
            当前浏览器不支持canvas
        </canvas>
    </div>

    <script>
        var list = [];
        var rect = {};
        var canvas = null;
        var ctx = null;
        var origin = { x: 0, y: 0 };
        var img = new Image();

        function getImgUrl() {
            var imgUrl = document.getElementById('canvasWrap').getAttribute('data-img');
            return imgUrl;
        }
        
        function initCanvas() {
            img.src = getImgUrl();
            img.onload = function () {
                drawImage(img);
                initEvent();
            };
        }
        
        function initEvent() {

            canvas.onmousedown = function (e) {
                origin.x = e.x + window.scrollX;
                origin.y = e.y + window.scrollY;
                canvas.onmousemove = function (e) {
                    setRect(e);
                    drawAllRect();
                    drawCurRect();
                };

            };

            canvas.onmouseup = function (e) {
                setRect(e, true);
                drawAllRect();
                canvas.onmousemove = null;
            };
            
        }
        
        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function setRect(event, add) {
            rect.x = event.clientX + window.scrollX;
            rect.y = event.clientY + window.scrollY;
            rect.width = rect.x- origin.x;
            rect.height = rect.y - origin.y;
            if(add === true) {
                list.push({
                    x: rect.x,
                    y: rect.y,
                    width: rect.width,
                    height: rect.height
                });
//                console.clear();
//                console.log(list);
            }
        }

        function drawAllRect() {
            clearCanvas();
            drawImage(img);

            ctx.save();
            ctx.strokeStyle = "#c00";
            ctx.lineWidth = 1;
            list.forEach(function (item) {
//                ctx.rect(item.x, item.y, -item.width, -item.height);
//                ctx.stroke();
                ctx.strokeRect(item.x, item.y, -item.width, -item.height);

                var coordinate = {
                    x: function () {
                        return item.width>=0 ? item.x-item.width : item.x;
                    },
                    y: function () {
                        return item.height>=0 ? item.y-item.height : item.y;
                    },
                    text: function () {
                        return 'X:' + this.x().toString() + ' - Y:' + this.y().toString();
                    }
                };
                ctx.font="12px Arial";
                ctx.fillStyle = 'red';
                ctx.fillText(coordinate.text(), coordinate.x(), coordinate.y() - 2);
                console.log(coordinate)
            });
            ctx.restore();
        }

        function drawCurRect() {
            ctx.save();
            ctx.strokeStyle = "#00c";
            ctx.lineWidth = 1;
//            ctx.rect(rect.x, rect.y, -rect.width, -rect.height);
//            ctx.stroke();
            ctx.strokeRect(rect.x, rect.y, -rect.width, -rect.height);
            ctx.restore();
        }
        
        function drawImage(image) {
            canvas.width = image.naturalWidth || image.width;
            canvas.height = image.naturalHeight || image.height;
            ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
        }

        window.onload = function () {
            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');

            initCanvas();
        }
    </script>
</body>
</html>